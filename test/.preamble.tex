\usepackage[left=1in,right=1in,top=1in,bottom=1in,twoside=true,headheight=35pt]{geometry}
\usepackage{pdflscape}
\usepackage{fontspec}
\usepackage{lastpage}
\usepackage{multirow}
\usepackage[table,x11names]{xcolor}
\usepackage{framed}
\usepackage{quoting}
\usepackage{colortbl}
\usepackage{booktabs}
\usepackage{rotating}
%\usepackage{tabularray}
\usepackage{rotfloat}
\usepackage{xltabular}
\usepackage{tabularray}
\usepackage{fancyhdr}
\usepackage{array}
\usepackage{graphicx}
\usepackage{titlesec}
\usepackage[parfill]{parskip}
\usepackage{titlesec}
\usepackage{wrapfig}
\usepackage{parskip}
\usepackage{listing}
\usepackage[outputdir=.tex-build,cache=false]{minted}
%\usepackage{url}
\usepackage{xurl}
\usepackage{xstring}
\usepackage[draft]{todonotes}
\usepackage{nameref} %allows referencing section names
\usepackage{xr} %allows for cross-document referencing: https://tex.stackexchange.com/questions/14364/cross-referencing-between-different-files
\usepackage[]{hyperref}
\usepackage{makecell}
\usepackage{wrapfig}
\usepackage{draftwatermark}
\usepackage{etoolbox}
%\newcommand{\@tmpdir}{}
%\DeclareOption{tmpdir}{%
%		\immediate\write18{mkdir ./.tex-build/}%
%		\renewcommand{\@tmpdir}{./tmp/../.tex-build/}}
\usepackage[pdf,tmpdir=.tex-build,auxdir=.tex-build]{graphviz}
%%graphviz: PDF location

%/../.tex-build/
%\usepackage{longtable}

%watermark
\SetWatermarkText{Draft - For Review Only\\Not for Production Release}
\SetWatermarkFontSize{2cm}
\SetWatermarkScale{1}
\SetWatermarkColor[gray]{0.7}
\SetWatermarkAngle{45}

%document header
\fancypagestyle{plain}{\pagestyle{fancy}}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{0pt}
\setlength{\tabcolsep}{0.1em} % for the horizontal padding
\fancyhead[CE,CO,LE,LO,RE,RO]{}
\fancyhead[C]{\centering%
	%\begin{tabular}{|m{2.0cm}|m{2.0cm}|m{7.0cm}|m{0.75cm}|m{1.25cm}|m{1.5cm}|@{}m{0pt}@{}}
		%{m{2.0cm} m{2.0cm} m{7.5cm} m{0.75cm} m{1cm} m{1.25cm} @{}m{0pt}@{}}
		%\begin{xltabular}{\linewidth}{p{1in} p{1in} X p{0.75in} p{0.75in}}
			%\begin{xltabular}{\linewidth}{p{2.0cm} p{2.1cm} p{7cm} p{1cm} p{1cm} p{1.5cm}}
				\begin{xltabular}{\linewidth}{p{0.79in} p{0.83in} p{3.15in} p{0.394in} p{0.5in} p{0.5in}}
					\hiderowcolors
					%\hline
					\multirow{2}{*}{\centering \includegraphics[height=0.75cm,width=2cm]{image/Recovery-Force-Blue.png}} &
					\centering \small\textbf{Doc Number} & \centering \small\textbf{Description} & \centering \small\textbf{Rev} & \centering \small\textbf{Page} & \centering \small\textbf{Approval} \tabularnewline %\cline{2-6}
					&
					\centering \small{\docnumber} &
					\centering \small{\centering \doctitle} &
					\centering \small{\docrevision} &
					\centering \small{\thepage\ of \pageref*{LastPage}} &
					\centering \small{\doceco} \tabularnewline
					\hline
					\multicolumn{6}{c}{\tiny{Confidential - Uncontrolled When Printed}} \tabularnewline
					%	\multicolumn{6}{c}{ } &\tabularnewline
				\end{xltabular}%
			}

%set font
\setmainfont{Arial}

% Select what to do with command \comment:  
% \newcommand{\comment}[1]{}  %comment not showed
\newcommand{\comment}[1]
{\par {\bfseries \color{red} Review comment: #1 \todo{review comment} \par}} %comment showed
\newcommand{\sourcefile}{\path}

%\usepackage{enumitem}

%custom commands
\makeatletter
\let\doctitle\@title
\makeatother

%custom inkscape \includesvg command from
%https://tex.stackexchange.com/a/148361
\newcommand{\executeiffilenewer}[3]{%
	\ifnum\pdfstrcmp{\pdffilemoddate{#1}}%
	{\pdffilemoddate{#2}}>0%
	{\immediate\write18{#3}}\fi%
}

% includesvg[includegraphics args]{file} command (windows-version). Inkscape location must be part of PATH 
\newcommand{\includesvg}[2][]{%
	\StrSubstitute{#2}{image/}{image/.tex-build/}[\mystring] %set the inkscape output directory to be in a .tex-build folder
	\outsvg[#1]{#2}{\mystring}%
}

\newcommand{\outsvg}[3][]{%
	\executeiffilenewer{#2.svg}{#3.pdf}{%
		"C:/Program Files/Inkscape/inkscape.exe" -z -C --file="#2.svg" --export-pdf="#3.pdf" >./.tex-build/temp.txt}%
	\ifthenelse{\equal{#1}{}}{%s
		\includegraphics{#3}}{%s
		\includegraphics[#1]{#3}}%
}

% command to allow references that show user-specified text, especially within a list
\makeatletter
\newcommand{\labitem}[2]{%
	%\def\@itemlabel{\textbf{#1}}
	\item
	\def\@currentlabel{#1}\label{#2}}
\makeatother

% allow easily centering a column in a table
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}}
\newcolumntype{B}[1]{>{\centering\arraybackslash}b{#1}}

%hyperlink properties
\hypersetup{
	colorlinks   = true,    % Colours links instead of ugly boxes
	urlcolor     = blue,    % Colour for external hyperlinks
	linkcolor    = blue,    % Colour of internal links
	citecolor    = red      % Colour of citations
}

%spacing around section titles
\titlespacing{\section}{0in}{0.1in}{0in}


	%enumeration properties
	%\setlistdepth{20}
	%\renewlist{itemize}{itemize}{20}
	%\renewlist{enumerate}{enumerate}{20}
	%\setlist[itemize]{label=$\cdot$}
	%\setlist[itemize,1]{label=\textbullet}
	%\setlist[itemize,2]{label=--}
	%\setlist[itemize,3]{label=*}
	
%section properties
\newcommand{\subsubsubsection}[1]{\paragraph{#1}\mbox{}}
\setcounter{secnumdepth}{4} 

%remove name of table of contents
\renewcommand*\contentsname{}

%allow underscores in text
\chardef\_=`_

%cross-document referencing
\makeatletter
\newcommand*{\addFileDependency}[1]{% argument=file name and extension
	\typeout{(#1)}
	\@addtofilelist{#1}
	\IfFileExists{#1}{}{\typeout{No file #1.}}
}
\makeatother

\newcommand*{\exdoc}[1]{%
	\externaldocument{#1}%
	\addFileDependency{#1.tex}%
	\addFileDependency{#1.aux}%
}

%shaded quotation blocks	
\colorlet{shadecolor}{lightgray}
\newenvironment{shadedquotation}
{\begin{shaded*}
		\quoting[leftmargin=0pt, vskip=0pt]
	}
	{\endquoting
	\end{shaded*}
}

%https://tex.stackexchange.com/questions/107864/ifusername-foo-else-fi
%allows getting the current users username
% #1 = control sequence to define
% #2 = variable to get the value of
\newcommand{\getvar}[2]{%
	\CatchFileEdef#1{"|kpsewhich -var-value #2"}{\endlinechar=-1 }%
}

\getvar{\usrname}{USERNAME}
%Note: for Linux this needs to say USER, for Windows it needs USERNAME

%% MAKE STANDARD DOCUMENT TABLES %%

%define new column type to allow centering with a fixed column width
\newcolumntype{x}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}

%commands for adding rows to tables automatically
\newcommand{\makerow}[1]{%
    %\def\delim{\def\delim{&}}%
    \def\delim{&}
	\renewcommand*{\do}[1]{#1}%
	%\renewcommand*{\do}[1]{#1}
	\docsvlist{#1}%
}
\newcommand{\dorow}[1]{\makerow{#1} \\}

%make attachments table from list
\newcommand\myAttachlist{}
\newcommand{\addAttachment}[3]{
	\def\delim{&}
	\listadd{\myAttachlist}{#1 \delim#2\delim #3}
}
\newcommand{\attachmentsTable}{
	\begin{xltabular}{\linewidth}{p{2in} p{1in} p{3in}}
		%\hline
		Attachment Number & Revision & Description \tabularnewline
		\hline
		\forlistloop{\dorow}{\myAttachlist}
		%\hline
	\end{xltabular}
}

%make revision table from list

\newcommand\myRevList{}
\newcommand{\addRevision}[5]{
	\def\delim{&}
	\listadd{\myRevList}{#1 \delim#2\delim #3 \delim#4\delim #5}
}
\newcommand{\revisionTable}{
	\begin{xltabular}{\linewidth}{p{1in} p{1in} p{2.5in} p{0.75in} p{0.5in}}
		%\hline
		Date & Changed By & Description & Revision & ECO \tabularnewline
		\hline
		\forlistloop{\dorow}{\myRevList}
		%\hline
	\end{xltabular}
}
